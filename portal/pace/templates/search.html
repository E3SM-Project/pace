{% extends "layout.html" %}
{% block topscripts %}
	<title> {%if homePageStr==""%}PACE - Experiments{%else%}PACE - Home{%endif%}</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.30.7/js/jquery.tablesorter.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.30.7/js/jquery.tablesorter.widgets.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.30.7/js/extras/jquery.tablesorter.pager.min.js"></script>
    <style>
    </style>
{% endblock %}

{% block content %}
{%if homePageStr!=""%}
<p style="text-align:center" id="homePageContent"><span><input class="form-control" id="homeSearchBar" style="font-size:1.5em;text-align:left;height:60px;width:40%;margin-left:5%;display:inline-block;margin-right:5px;margin-top:2px;" placeholder="Keyword"/></span>
<button class="btn-lg btn-info" style="height:3em;margin-top:2px;" onclick="searchAndCheck(homeSearchBar.value,matchModeCheck.checked)">Search</button><br>
<input type="checkbox" id="matchModeCheck" style="margin-top:10px;margin-right:4px"/>Category Search</p>
{%else%}
<h4>Experiments : </h4>
{%endif%}
<p style="text-align:right">
	<a><button class="btn btn-primary btn-dark" id='searchCompareBtn' disabled>Compare</button></a>
	<a><button class="btn btn-primary btn-dark" id='searchViewBtn' disabled>View</button></a>
</p>
<!--style="border:1px solid lightgrey;border-radius:5px"-->
<table id="expTable" class="table table-striped">
<thead>
    <tr>
        <th>ID</th>
		<th>User</th>
		<th>Machine</th>
		<th>Compset</th>
		<th>Res</th>
		<th>Total PEs</th>
		<th>Run Length <br><span style="font-size:75%">(days)</span></th>
		<th>Throughput <br><span style="font-size:75%">(sim_years/day)</span></th>
		<th>MPI Tasks/Node</th>
		<th>ExpDate</th>
		<th>Summary Charts</th>
    </tr>
</thead>
<tbody id="searchBody"></tbody>
</table>
<p style="text-align:right;"><button class="btn btn-dark" id="moreBtn" onclick="searchAndCheck()">More Exps</button></p>
<br>
{% endblock %}

{% block bottomscripts %}
<script src="/static/js/search.js"></script>
<script>
var homePage = false;
{{sq|safe}}
{{homePageStr|safe}}

function searchAndCheck(sq = searchQuery,matchMode = false){
	searchObj.search(sq,searchObj.limit,()=>{
	if(searchObj.searchData.length == searchObj.limit){
	 searchObj.limit*=2;
	}
	else moreBtn.style.display = "none";
	},matchMode);
}

{%if homePageStr !=""%}
matchModeCheck.onclick = function(){
	homeSearchBar.placeholder = (this.checked?"user:name machine:platform colname:value ...":"Keyword");
	if(homeSearchBar.innerHTML.replace(" ","")!="")
		searchAndCheck(homeSearchBar.value,matchModeCheck.checked);
}
searchBar.style.display = "none";
searchButton.style.display = "none";

//predictive search + home search functionality:
homeSearchPredict = new predictiveSearch.element(homeSearchBar,"hsb");
homeSearchBar.onkeydown = evt=>{
	if(evt.key == "Enter" && homeSearchPredict.allowEnter){
		searchObj.limit = 20;
		if(homeSearchBar.value!='') searchAndCheck(homeSearchBar.value,matchModeCheck.checked);
	}
	homeSearchPredict.keydownListener(evt);
};
homeSearchBar.onkeyup = evt=>{
  homeSearchPredict.keyupListener(evt);
  if(homeSearchBar.value!="")
      $.get(detectRootUrl()+"ajax/similarDistinct/"+homeSearchPredict.inputWords[homeSearchPredict.wordIndex],data=>homeSearchPredict.refreshKeywords(JSON.parse(data)));
}
homeSearchBar.onblur = ()=>setTimeout(()=>predictiveSearch.menuBlur("hsb"),150);
homeSearchPredict.pTextMenu.style.left="40%";
{%endif%}

$(document).ready(function(){
searchAndCheck();
/*$("#expTable").tablesorter({
	widthFixed: false
	});*/
});
</script>
{% endblock %}
