{% extends "layout.html" %}

{% block topscripts %}
<title>PACE: Model Timing View</title>
        <style>
            #dataInfo{
                border:.01in solid;
                position: absolute;
                left:20.5%;
                width:80%;
                background-image:url(/static/img/ornlLeaf.svg); 
                background-position: center;
                background-repeat: no-repeat;
                background-size: auto;
            }
            #dataList{
                overflow: scroll;
                width:20%;
                position: absolute;
                resize:vertical;
                left:0px;
            }
            ul{
                list-style-type: none;
            }
            #backButton{
                position: absolute;
                left:20.5%;
        
            }
            #mtMain{
                font-family: monospace;
                margin-bottom:70%
            }
            .unused{
                display: none;
            }
            #compareSelectDiv{
                width:60%;
                height:60%;
                position:absolute;
                top:20%;
                left:20%;
                box-shadow:0px 5px 5px gray;
                background-color:white;
                opacity:0;
                display:none;
                border-radius:10px;
                font-family:arial;
                text-align:center;
                overflow:scroll;
            }
            .compareDiv{
                width:10em;
                height:7em;
                display:inline-block;
                margin-right:1em;
                border:.1em solid gray;
                border-radius:10px;
            }
            #nodeId{
                font-family: monospace;
                position:absolute;
                background-color:lightgray;
                border-radius:5px;
            }
            </style>
<!--Search bar CSS-->
<link rel="stylesheet" type="text/css" href="/static/css/quickSearch.css" />
{% endblock %}


{% block content %}
<!--Author: Zachary Mitchell
    Purpose: View your prevsiously parsed model_timing files in style!
    Summarize any scope of timeNodes with sum or averages, and with any value you want! (Wallclock, min/max, etc)-->
        <div id="mtMain">
            <span id="nodeId"></span>
            <div>
                <select id="valueName" onclick="(comparisonMode.on?comparisonMode.viewChart(comparisonMode.exp.currentEntry.name):changeGraph(currExp.currentEntry) )"></select>
                <select id="mode" class="unused" onclick="(comparisonMode.on?comparisonMode.viewChart(comparisonMode.exp.currentEntry.name):changeGraph(currExp.currentEntry) )">
                    <option value="sum" selected>Sum</option>
                    <option value="avg">Average</option>
                </select>
                <select id="threadSelect"></select>
                <button id="compareButton" onclick="compDivObj.toggle()">Compare</button>
                <input type="checkbox" onclick="stackedCharts = this.checked;(comparisonMode.on?comparisonMode.viewChart(comparisonMode.exp.currentEntry.name):changeGraph(currExp.currentEntry) );" checked/>Stacked bars <input id="dmCheck" type="checkbox" onclick="dmObj.toggle(this.checked)"/>Dark Mode
                <input type="text" id="quickSearchBar" placeholder="Quick Search"/>
            </div>
            <div id="dataInfo"><canvas id="chartTag"></canvas></div>
            <div id="dataList">
            <select id="expSelect" onchange="switchExperiment()"></select>
            <br>
            <button id="summaryButton">Summary</button><div id="listContent"></div></div>
            <button id="backButton"><-Back</button>
        </div>
    <div id="compareSelectDiv">
    <h2>Select the threads you wish to compare.</h2><br>
    <p><button onclick='compDivObj.makeExp()'>Add</button></p>
    <div id="compDivBody"></div>
    <p style="text-align:center"><button id="compareGo" onclick="compDivObj.scan()">Go!</button></p>
    </div>
{% endblock %}

{% block bottomscripts %}
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
    <script src="/static/js/quickSearch.js"></script>
	<script src="/static/js/domFunctions.js"></script>
	<script src="/static/js/modelTiming.js"></script>
	<script src="/static/js/paceLoadScreen.js"></script>
	<script>//Fire up the summary:
    var expData = undefined;
    var compare = undefined;
    var threadList = undefined;
    var onMtPage = true;
    {{exp|safe}}
    /*$(document).ajaxError(()=>{
        if(expGetFunc.length > 0){
            alert("Could not find this experiment");
            //location.replace("/exps");
        }
    });*/
	$(document).ready(()=>{
            dmObj.toggle(dmObj.checkCookies());
            dmCheck.checked = dmObj.checkCookies();
			animate();
            if(expData!=undefined){
                for(let i=0;i<expData.length;i++){
                    if(i<expData.length-1)
                        getExperiment(expData[i][0],expData[i][1],false);
                    else{
                        getExperiment(expData[i][0],expData[i][1],()=>{
                        expDownloadDefault();
                        if(threadList){
                            threadList.forEach((element,index)=>{
                                expList[index].currThread = element*1;
                            });
                        }
                        if(threadList && !compare && threadList.length == expData.length){
                            threadSelect.selectedIndex = threadList[threadList.length-1]*1;
                            threadSelect.onchange();
                        }
                        if(compare){
                            let resultList = [];
                            expList.forEach( (element,index)=>{
                                resultList.push([element,( (threadList!=undefined && threadList[index]!=undefined) ?threadList[index]*1:0)]);
                            });
                            comparisonMode.new(resultList);
                            comparisonMode.start();
                        }
                    });
                    }
                }
            }
			else getExperiment(-1,"0000");
			});</script>
{% endblock %}