{% extends "layout.html" %}

{% block topscripts %}
<title>PACE: Model Timing View</title>
<link rel="stylesheet" type="text/css" href="/static/css/modelTiming.css" />
<!--Search bar CSS-->
<link rel="stylesheet" type="text/css" href="/static/css/quickSearch.css" />
{% endblock %}

{% block content %}
<!--Author: Zachary Mitchell
    Purpose: View your prevsiously parsed model_timing files in style!
    Summarize any scope of timeNodes with sum or averages, and with any value you want! (Wallclock, min/max, etc)-->
        <div id="mtMain">
            <span id="nodeId"></span>
            <div>
                <select id="valueName" onclick="(comparisonMode.on?comparisonMode.viewChart(comparisonMode.exp.currentEntry.name):changeGraph(currExp.currentEntry) )"></select>
                <select id="mode" class="unused" onclick="(comparisonMode.on?comparisonMode.viewChart(comparisonMode.exp.currentEntry.name):changeGraph(currExp.currentEntry) )">
                    <option value="sum" selected>Sum</option>
                    <option value="avg">Average</option>
                </select>
                <select id="threadSelect"></select>
                <button id="compareButton" onclick="compDivObj.toggle()">Compare</button>
                <span class="checkboxRow"><input type="checkbox" onclick="stackedCharts = this.checked;(comparisonMode.on?comparisonMode.viewChart(comparisonMode.exp.currentEntry.name):changeGraph(currExp.currentEntry) );" checked/>Stacked bars <input id="dmCheck" type="checkbox" onclick="dmObj.toggle(this.checked)"/>Dark Mode</span>
                <span id="quickSearchContainer">
                    <input type="text" id="quickSearchBar" placeholder="Quick Search"/>
                </span>
            </div>
            <div id="dataInfo"><div id="chartResizeContainer"><canvas id="chartTag"></canvas></div></div>
            <div id="dataList">
                <select id="expSelect" onchange="switchExperiment()"></select>
                <br>
                <button id="summaryButton">Summary</button><div id="listContent"></div>
            </div>
            <button id="backButton"><-Back</button>
            <div id="zoomDiv"><button onclick="resizeChartVal=(resizeChartVal <=1?1:resizeChartVal-25);resizeChart(resizeChartVal)">-</button><button onclick="resizeChartVal+=25;resizeChart(resizeChartVal)">+</button></div>
        </div>
    <div id="compareSelectDiv">
    <h2>Select the threads you wish to compare.</h2><br>
    <p><button onclick='compDivObj.makeExp()'>Add</button></p>
    <div id="compDivBody"></div>
    <p style="text-align:center"><button id="compareGo" onclick="compDivObj.scan()">Go!</button></p>
    </div>
{% endblock %}

{% block bottomscripts %}
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
    <script src="/static/js/quickSearch.js"></script>
	<script src="/static/js/domFunctions.js"></script>
	<script src="/static/js/modelTiming.js"></script>
	<script src="/static/js/paceLoadScreen.js"></script>
	<script>//Fire up the summary:
    /*$(document).ajaxError(()=>{
        if(expGetFunc.length > 0){
            alert("Could not find this experiment");
            //location.replace("/exps");
        }
    });*/
    //searchBar.parentElement.parentElement.style.display="";
	$(document).ready(()=>{
        var expData = undefined;
        var compare = undefined;
        var threadList = undefined;
        var onMtPage = true;
        {{exp|safe}}
        dataInfo.style.height = (window.innerHeight*.8)+"px";
        dmObj.toggle(dmObj.checkCookies());
        dmCheck.checked = dmObj.checkCookies();
		animate();
        if(expData!=undefined){
            for(let i=0;i<expData.length;i++){
                if(i<expData.length-1)
                    getExperiment(expData[i][0],expData[i][1],false);
                else{
                    getExperiment(expData[i][0],expData[i][1],()=>{
                    expDownloadDefault();
                    if(threadList){
                        threadList.forEach((element,index)=>{
                            expList[index].currThread = element*1;
                        });
                    }
                    if(threadList && !compare && threadList.length == expData.length){
                        threadSelect.selectedIndex = threadList[threadList.length-1]*1;
                        threadSelect.onchange();
                    }
                    if(compare){
                        let resultList = [];
                        expList.forEach( (element,index)=>{
                            resultList.push([element,( (threadList!=undefined && threadList[index]!=undefined) ?threadList[index]*1:0)]);
                        });
                        comparisonMode.new(resultList);
                        comparisonMode.start();
                    }
                });
                }
            }
        }
		else getExperiment(-1,"0000");
        window.onresize();
	});</script>
{% endblock %}